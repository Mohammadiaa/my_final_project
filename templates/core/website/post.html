{% extends 'base.html' %} {% load static %} {% block content %} 
{% load blog_extras %}

<div class="row tm-row">
  <div class="col-12">
    <hr class="tm-hr-primary tm-mb-55" />

    <!-- Video player 1422x800 -->
    {% if post.video %}
    <video width="954" height="535" controls class="tm-mb-40">
      <source src="{{post.video.url}}" type="video/mp4" />
      Your browser does not support the video tag.
    </video>

    {% elif post.video_url %}
    <iframe
      width="954"
      height="535"
      src="{{ post.video_url }}"
      frameborder="0"
      allowfullscreen
      class="tm-mb-40"
    >
    </iframe>

    {% elif post.image %}
    <img
      src="{{ post.image.url }}"
      alt="{{ post.title }}"
      class="img-fluid tm-mb-40"
    />
    {% endif %}
  </div>
</div>

<div class="row tm-row">
  <div class="col-lg-8 tm-post-col">
    <div class="tm-post-full">
      <div class="mb-4">
        <h2 class="pt-2 tm-color-primary tm-post-title">{{post.title}}</h2>
        <p class="tm-mb-40">
          {% if post.published_date %} {{ post.published_date|date:"F d, Y" }}
          {% endif %}
          <br />
          posted by <a href="{% url 'blog:author' post.author.pk %}">{{ post.author.username }}</a>
          <br />
          <span>{{ post.counted_view }} views</span>
        </p>
        <p>{{ post.content|linebreaks }}</p>

        {% if post.tags.all %}
        <span class="d-block text-right tm-color-primary">
          {% for tag in post.tags.all %}
          <a href="{% url 'blog:tag' tag.pk %}" class="tm-category-link">
            {{ tag.name }} </a
          >{% if not forloop.last %} . {% endif %} {% endfor %}
        </span>
        {% endif %}
      </div>

      <!-- Comments -->
      <div>
        <h2 class="tm-color-primary tm-post-title">{{ approved_comments_count }} Comments</h2>
        <hr class="tm-hr-primary tm-mb-45" />

        {% for comment in approved_comments %}
        <div class="tm-comment tm-mb-45">
          <figure class="tm-comment-figure">
            <img
              src="{% static 'img/comment-1.jpg' %}"
              alt="Image"
              class="mb-2 rounded-circle img-thumbnail"
            />
            <figcaption class="tm-color-primary text-center">
              {{ comment.name }}
            </figcaption>
          </figure>
          <div>
            <p>{{ comment.message }}</p>
            <div class="d-flex justify-content-between">
              <span class="tm-color-primary">
                {{ comment.created_date|date:"F d, Y H:i" }}
              </span>
            </div>
          </div>
        </div>

        {% empty %}
        <p>No comments yet. Be the first to comment!</p>
        {% endfor %}

        <form action="" method="POST" class="mb-5 tm-comment-form">
          {% csrf_token %}
          <h2 class="tm-color-primary tm-post-title mb-4">Your comment</h2>
          <div class="mb-4">
            <input
              class="form-control"
              name="name"
              type="text"
              placeholder="username"
              required
            />
          </div>
          <div class="mb-4">
            <input
              class="form-control"
              name="email"
              type="text"
              placeholder="email"
              required
            />
          </div>
          <div class="mb-4">
            <textarea
              class="form-control"
              name="message"
              rows="6"
              placeholder="message"
              required
            ></textarea>
          </div>
          <div class="text-right">
            <button class="tm-btn tm-btn-primary tm-btn-small" type="submit">
              Submit
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <aside class="col-lg-4 tm-aside-col">
    <div class="tm-post-sidebar">
      <hr class="mb-3 tm-hr-primary" />
      <h2 class="mb-4 tm-post-title tm-color-primary">Categories</h2>
      <ul class="tm-mb-75 pl-5 tm-category-list">
        {% for cat in post.categories.all %}
        <li>
          <a href="{% url 'blog:category' cat.id %}"> {{ cat.name }} </a>
          {% if not forloop.last %}, {% endif %}
        </li>
        {% empty %}
        <li>No category</li>
        {% endfor %}
      </ul>

      <hr class="mb-3 tm-hr-primary" />
      <h2 class="tm-mb-40 tm-post-title tm-color-primary">Related Posts</h2>

      {% latest_posts as related_posts %} 
      {% for post in related_posts %}
      <a href="{% url 'blog:single' post.pk %}" class="d-block tm-mb-40">
        <figure>
          {% if post.image %}
          <img
            src="{{ post.image.url }}"
            alt="{{ post.title }}"
            class="mb-3 img-fluid"
          />
          {% else %}
          <img
            src="{% static 'img/default.jpg' %}"
            alt="default"
            class="mb-3 img-fluid"
          />
          {% endif %}
          <figcaption class="tm-color-primary">{{ post.title }}</figcaption>
        </figure>
      </a>
      {% endfor %}
    </div>
  </aside>
</div>
{% endblock %}
